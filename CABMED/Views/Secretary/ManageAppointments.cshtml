@model List<CABMED.Models.RendezVous>
@{
    ViewBag.Title = "Gérer les Rendez-vous";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    /* Professional Orange Medical Theme */
    :root {
        --primary-orange: #ea580c;
        --light-orange: #fb923c;
        --dark-orange: #c2410c;
        --orange-accent: #f97316;
        --white: #FFFFFF;
        --light-bg: #F7F8FC;
        --dark-text: #2C2C54;
        --light-text: #8B8BA7;
        --card-shadow: 0 4px 20px rgba(234, 88, 12, 0.12);
        --hover-shadow: 0 8px 35px rgba(234, 88, 12, 0.2);
        --gradient-primary: linear-gradient(135deg, #ea580c 0%, #fb923c 100%);
    }

    .appointments-container {
        max-width: 1400px;
        margin: 30px auto;
        padding: 0 20px;
    }

    /* Header */
    .page-header-custom {
        background: var(--gradient-primary);
        color: white;
        padding: 40px;
        border-radius: 20px;
        margin-bottom: 35px;
        box-shadow: var(--card-shadow);
        position: relative;
        overflow: hidden;
    }

    .page-header-custom::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -10%;
        width: 300px;
        height: 300px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 50%;
    }

    .page-header-custom h2 {
        margin: 0;
        font-size: 30px;
        font-weight: 700;
        position: relative;
        z-index: 1;
    }

    .page-header-custom p {
        margin: 8px 0 0 0;
        opacity: 0.95;
        font-size: 15px;
        position: relative;
        z-index: 1;
    }

    /* Filter Bar */
    .filter-bar {
        background: white;
        border: 1px solid rgba(234, 88, 12, 0.08);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 28px;
        box-shadow: var(--card-shadow);
    }

    .search-input {
        border-radius: 10px;
        border: 2px solid rgba(234, 88, 12, 0.15);
        padding: 12px 16px;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .search-input:focus {
        border-color: var(--primary-orange);
        box-shadow: 0 0 0 4px rgba(234, 88, 12, 0.1);
        outline: none;
    }

    /* Appointments Table */
    .appointments-table {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: var(--card-shadow);
        border: 1px solid rgba(234, 88, 12, 0.08);
    }

    .appointments-table table {
        margin-bottom: 0;
    }

    .appointments-table thead {
        background: var(--gradient-primary);
        color: white;
    }

    .appointments-table thead th {
        border: none;
        padding: 18px 16px;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 12px;
        letter-spacing: 0.8px;
    }

    .appointments-table tbody tr {
        border-bottom: 1px solid rgba(234, 88, 12, 0.08);
        transition: all 0.3s ease;
    }

    .appointments-table tbody tr:hover {
        background-color: rgba(234, 88, 12, 0.03);
        transform: translateX(3px);
    }

    .appointments-table tbody td {
        padding: 20px 16px;
        vertical-align: middle;
    }

    .status-badge {
        padding: 5px 12px;
        border-radius: 14px;
        font-size: 11px;
        font-weight: 600;
        color: white;
        display: inline-block;
    }

    .status-confirmed { background: linear-gradient(135deg, #5FCF80 0%, #43A047 100%); }
    .status-pending { background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%); }
    .status-cancelled { background: linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%); }

    .empty-state {
        text-align: center;
        padding: 80px 20px;
        background: white;
        border-radius: 16px;
        box-shadow: var(--card-shadow);
    }

    .empty-state-icon {
        font-size: 80px;
        color: rgba(234, 88, 12, 0.12);
        margin-bottom: 24px;
    }
</style>

<div class="appointments-container">
    
    <!-- Header -->
    <div class="page-header-custom">
        <h2>
            <span class="glyphicon glyphicon-calendar"></span>
            Gérer les Rendez-vous
        </h2>
        <p>Consultez et gérez tous les rendez-vous du cabinet</p>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="row">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-addon" style="background: var(--gradient-primary); color: white; border: none; border-radius: 10px 0 0 10px;">
                        <span class="glyphicon glyphicon-search"></span>
                    </span>
                    <input type="text" 
                           id="searchInput" 
                           class="form-control search-input" 
                           placeholder="Rechercher par patient, médecin..."
                           style="border-left: none; border-radius: 0 10px 10px 0;">
                </div>
            </div>
            <div class="col-md-3">
                <input type="date" 
                       id="dateFilter" 
                       class="form-control search-input" 
                       placeholder="Filtrer par date">
            </div>
            <div class="col-md-3">
                <button type="button" 
                        class="btn btn-default btn-block" 
                        onclick="clearFilters()"
                        style="border-radius: 10px; border: 2px solid rgba(113, 50, 202, 0.15); font-weight: 600;">
                    <span class="glyphicon glyphicon-refresh"></span>
                    Réinitialiser
                </button>
            </div>
        </div>
    </div>

    <!-- Appointments Table -->
    @if (Model != null && Model.Any())
    {
        <div class="appointments-table">
            <table class="table">
                <thead>
                    <tr>
                        <th>Date & Heure</th>
                        <th>Patient</th>
                        <th>Médecin</th>
                        <th>Motif</th>
                        <th>Statut</th>
                    </tr>
                </thead>
                <tbody id="appointmentsTableBody">
                    @foreach (var rdv in Model)
                    {
                        var patient = rdv.Users;
                        var doctor = rdv.Users1;
                        var statusClass = rdv.Statut?.ToLower() == "confirmé" || rdv.Statut?.ToLower() == "confirme" ? "status-confirmed" : 
                                         rdv.Statut?.ToLower() == "en attente" ? "status-pending" : "status-cancelled";
                        
                        <tr class="appointment-row"
                            data-date="@rdv.DateHeureDebut.ToString("yyyy-MM-dd")"
                            data-patient="@(patient != null ? (patient.Prenom + " " + patient.Nom).ToLower() : "")"
                            data-doctor="@(doctor != null ? (doctor.Prenom + " " + doctor.Nom).ToLower() : "")">
                            
                            <td>
                                <strong style="color: var(--primary-orange);">@rdv.DateHeureDebut.ToString("dd/MM/yyyy")</strong><br>
                                <small class="text-muted">@rdv.DateHeureDebut.ToString("HH:mm") - @rdv.DateHeureFin.ToString("HH:mm")</small>
                            </td>
                            
                            <td>
                                @if (patient != null)
                                {
                                    <strong>@patient.Prenom @patient.Nom</strong><br>
                                    <small class="text-muted">@patient.Telephone</small>
                                }
                                else
                                {
                                    <span class="text-muted">Non disponible</span>
                                }
                            </td>
                            
                            <td>
                                @if (doctor != null)
                                {
                                    <strong>Dr. @doctor.Prenom @doctor.Nom</strong><br>
                                    if (!string.IsNullOrEmpty(doctor.Specialite))
                                    {
                                        <small class="text-muted">@doctor.Specialite</small>
                                    }
                                }
                                else
                                {
                                    <span class="text-muted">Non assigné</span>
                                }
                            </td>
                            
                            <td>
                                @if (!string.IsNullOrEmpty(rdv.Motif))
                                {
                                    <div style="max-width: 250px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="@rdv.Motif">
                                        @rdv.Motif
                                    </div>
                                }
                                else
                                {
                                    <span class="text-muted">Non spécifié</span>
                                }
                            </td>
                            
                            <td>
                                <span class="status-badge @statusClass">@(rdv.Statut ?? "En attente")</span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- No Results Message -->
        <div id="noResultsMessage" class="empty-state" style="display: none; margin-top: 20px;">
            <div class="empty-state-icon">
                <span class="glyphicon glyphicon-search"></span>
            </div>
            <h3>Aucun résultat trouvé</h3>
            <p>Essayez de modifier vos critères de recherche</p>
        </div>
    }
    else
    {
        <div class="empty-state">
            <div class="empty-state-icon">
                <span class="glyphicon glyphicon-inbox"></span>
            </div>
            <h3>Aucun rendez-vous</h3>
            <p>Il n'y a pas encore de rendez-vous enregistrés.</p>
            <div style="margin-top: 30px;">
                <a href="@Url.Action("CreateAppointment", "Secretary")" class="btn btn-primary btn-lg" style="background: var(--gradient-primary); border: none; border-radius: 12px; padding: 14px 28px;">
                    <span class="glyphicon glyphicon-plus"></span>
                    Créer un rendez-vous
                </a>
            </div>
        </div>
    }

    <!-- Back Button -->
    <div class="text-center" style="margin-top: 35px;">
    <a href="@Url.Action("Index", "Secretary")" class="btn btn-default btn-lg" style="border-radius: 12px; padding: 13px 32px; border: 2px solid rgba(234, 88, 12, 0.15); background: white; color: #ea580c; font-weight: 600;">
            <span class="glyphicon glyphicon-arrow-left"></span>
       Retour au tableau de bord
        </a>
    </div>

</div>

@section Scripts {
<script>
    $(document).ready(function() {
        $('#searchInput').on('keyup', function() {
            filterAppointments();
        });

        $('#dateFilter').on('change', function() {
            filterAppointments();
        });
    });

    function filterAppointments() {
        var searchText = $('#searchInput').val().toLowerCase();
        var dateFilter = $('#dateFilter').val();
        var visibleCount = 0;

        $('.appointment-row').each(function() {
            var row = $(this);
            var patient = row.data('patient');
            var doctor = row.data('doctor');
            var rowDate = row.data('date');
            
            var matchesSearch = searchText === '' || 
                               patient.indexOf(searchText) > -1 || 
                               doctor.indexOf(searchText) > -1;
            
            var matchesDate = dateFilter === '' || rowDate === dateFilter;
            
            if (matchesSearch && matchesDate) {
                row.show();
                visibleCount++;
            } else {
                row.hide();
            }
        });

        if (visibleCount === 0) {
            $('#noResultsMessage').show();
            $('.appointments-table').hide();
        } else {
            $('#noResultsMessage').hide();
            $('.appointments-table').show();
        }
    }

    function clearFilters() {
        $('#searchInput').val('');
        $('#dateFilter').val('');
        $('.appointment-row').show();
        $('#noResultsMessage').hide();
        $('.appointments-table').show();
    }
</script>
}
