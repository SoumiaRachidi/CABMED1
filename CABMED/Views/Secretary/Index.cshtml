@{
    ViewBag.Title = "Espace Secrétaire";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var pendingCount = ViewBag.PendingRequests is int pc ? pc : Convert.ToInt32(ViewBag.PendingRequests ?? 0);
    var nextPending = ViewBag.NextPendingRequest as CABMED.ViewModels.AppointmentRequestViewModel;
}

<style>
    /* Secretary Orange Theme */
    :root {
        --primary-orange: #ea580c;
        --light-orange: #fb923c;
        --dark-orange: #c2410c;
        --orange-accent: #f97316;
        --white: #FFFFFF;
        --light-bg: #F7F8FC;
        --dark-text: #2C2C54;
        --light-text: #8B8BA7;
        --card-shadow: 0 4px 20px rgba(234, 88, 12, 0.12);
        --hover-shadow: 0 8px 35px rgba(234, 88, 12, 0.2);
        --gradient-primary: linear-gradient(135deg, #ea580c 0%, #fb923c 100%);
        --gradient-dark: linear-gradient(135deg, #c2410c 0%, #ea580c 100%);
    }

    body {
        background: var(--light-bg);
    }

    .secretary-dashboard {
        max-width: 1400px;
        margin: 0 auto;
        padding: 30px 20px;
    }

    /* Welcome Header */
    .welcome-header {
        background: var(--gradient-primary);
        border-radius: 20px;
        padding: 45px;
        color: white;
        margin-bottom: 35px;
        box-shadow: var(--card-shadow);
        position: relative;
        overflow: hidden;
    }

    .welcome-header::before {
        content: '';
        position: absolute;
        top: -60%;
        right: -8%;
        width: 350px;
        height: 350px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 50%;
    }

    .welcome-header::after {
        content: '';
        position: absolute;
        bottom: -40%;
        left: -5%;
        width: 280px;
        height: 280px;
        background: rgba(196, 123, 228, 0.15);
        border-radius: 50%;
    }

    .welcome-header h1 {
        margin: 0 0 12px 0;
        font-size: 34px;
        font-weight: 700;
        position: relative;
        z-index: 1;
    }

    .welcome-header p {
        margin: 0;
        font-size: 16px;
        opacity: 0.95;
        position: relative;
        z-index: 1;
    }

    /* Quick Action Buttons */
    .quick-actions {
        display: flex;
        gap: 12px;
        margin-top: 25px;
        flex-wrap: wrap;
        position: relative;
        z-index: 1;
    }

    .quick-actions .btn {
        border-radius: 12px;
        padding: 12px 24px;
        font-weight: 600;
        border: none;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    }

    .quick-actions .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 25px rgba(0, 0, 0, 0.18);
    }

    .quick-actions .btn-primary {
        background: var(--white);
        color: var(--primary-orange);
    }

    .quick-actions .btn-warning {
        background: rgba(255, 255, 255, 0.25);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.4);
    }

    .quick-actions .btn-info {
        background: rgba(255, 255, 255, 0.25);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.4);
    }

    .quick-actions .btn-success {
        background: rgba(255, 255, 255, 0.25);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.4);
    }

    .quick-actions .btn-default {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.35);
    }

    /* Stats Cards */
    .stats-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-bottom: 35px;
    }

    .stat-card {
        background: white;
        border-radius: 18px;
        padding: 28px;
        box-shadow: var(--card-shadow);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(234, 88, 12, 0.08);
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--gradient-primary);
    }

    .stat-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--hover-shadow);
        border-color: var(--primary-orange);
    }

    .stat-card-header {
        display: flex;
        align-items: center;
        gap: 18px;
        margin-bottom: 18px;
    }

    .stat-icon {
        width: 62px;
        height: 62px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 26px;
        color: white;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.12);
    }

    .stat-icon.purple { background: var(--gradient-primary); }
    .stat-icon.pink { background: linear-gradient(135deg, #fb923c 0%, #f97316 100%); }
    .stat-icon.dark { background: var(--gradient-dark); }

    .stat-info {
        flex: 1;
    }

    .stat-value {
        font-size: 38px;
        font-weight: 700;
        color: var(--primary-orange);
        line-height: 1;
        margin-bottom: 6px;
    }

    .stat-label {
        font-size: 14px;
        color: var(--light-text);
        font-weight: 500;
    }

    .stat-link {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        color: var(--primary-orange);
        font-size: 13px;
        font-weight: 600;
        text-decoration: none;
        margin-top: 12px;
        transition: all 0.3s ease;
    }

    .stat-link:hover {
        gap: 10px;
        color: var(--dark-orange);
    }

    /* Content Grid */
    .content-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 28px;
        margin-bottom: 35px;
    }

    /* Action Tiles */
    .action-tiles {
        background: white;
        border-radius: 18px;
        padding: 32px;
        box-shadow: var(--card-shadow);
        border: 1px solid rgba(234, 88, 12, 0.08);
    }

    .section-title {
        font-size: 19px;
        font-weight: 700;
        color: var(--dark-text);
        margin-bottom: 22px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .section-title .glyphicon {
        color: var(--primary-orange);
        font-size: 20px;
    }

    .tiles-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }

    .action-tile {
        background: linear-gradient(135deg, #F7F8FC 0%, #F0F1F7 100%);
        border-radius: 14px;
        padding: 24px;
        text-align: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-decoration: none;
        display: block;
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
    }

    .action-tile::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--gradient-primary);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .action-tile:hover::before {
        opacity: 0.08;
    }

    .action-tile:hover {
        transform: translateY(-5px);
        border-color: var(--primary-orange);
    box-shadow: 0 8px 25px rgba(234, 88, 12, 0.2);
    }

    .action-tile .glyphicon {
        font-size: 32px;
   display: block;
        margin-bottom: 12px;
 position: relative;
        z-index: 1;
        transition: all 0.3s ease;
      color: var(--primary-orange);
    }

    .action-tile span:last-child {
        font-size: 14px;
        font-weight: 600;
        color: var(--dark-text);
        position: relative;
        z-index: 1;
    }

    .action-tile .badge {
   position: absolute;
        top: 10px;
        right: 10px;
      background: var(--primary-orange);
        color: white;
        padding: 4px 10px;
   border-radius: 12px;
        font-size: 11px;
        z-index: 2;
    }

    /* Urgent Requests Card */
    .urgent-card {
      background: white;
   border-radius: 18px;
        padding: 32px;
  box-shadow: var(--card-shadow);
        border: 1px solid rgba(234, 88, 12, 0.08);
    }

    .request-item {
      background: linear-gradient(135deg, #F7F8FC 0%, #F0F1F7 100%);
        border-left: 4px solid var(--primary-orange);
  border-radius: 10px;
        padding: 20px;
   margin-bottom: 14px;
        transition: all 0.3s ease;
    }

    .request-item:hover {
        transform: translateX(8px);
        box-shadow: 0 4px 18px rgba(234, 88, 12, 0.15);
    }

    .request-item.urgent {
        border-left-color: var(--orange-accent);
     animation: pulse 2s infinite;
    }

    @@keyframes pulse {
        0%, 100% { box-shadow: 0 0 0 0 rgba(234, 88, 12, 0.4); }
     50% { box-shadow: 0 0 0 10px rgba(234, 88, 12, 0); }
    }

    .priority-badge {
        padding: 5px 12px;
        border-radius: 14px;
        font-size: 11px;
        font-weight: 600;
        color: white;
        display: inline-block;
    }

    .priority-high { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    .priority-medium { background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%); }
    .priority-low { background: linear-gradient(135deg, #5FCF80 0%, #43A047 100%); }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
    }

    .empty-state .glyphicon {
        font-size: 48px;
        color: rgba(234, 88, 12, 0.15);
    margin-bottom: 15px;
  }

    @@media (max-width: 992px) {
        .content-grid {
            grid-template-columns: 1fr;
        }
    }

    @@media (max-width: 768px) {
        .stats-section {
            grid-template-columns: 1fr;
        }
        
        .tiles-grid {
            grid-template-columns: 1fr;
        }

        .welcome-header {
            padding: 30px 20px;
        }

        .quick-actions {
            flex-direction: column;
        }

        .quick-actions .btn {
            width: 100%;
        }
    }
</style>

<div class="secretary-dashboard">
    
    <!-- Welcome Header - Purple Gradient -->
    <div class="welcome-header">
        <h1>Espace Secrétaire</h1>
        <p>Bienvenue, @ViewBag.UserName - Gérez les demandes de rendez-vous et le planning</p>
        
        <div class="quick-actions">
            <a href="@Url.Action("AppointmentRequests", "Secretary")" class="btn btn-warning">
                <span class="glyphicon glyphicon-list-alt"></span> Demandes de RDV
                @if (pendingCount > 0)
                {
                    <span class="badge" style="background: #fff; color: var(--primary-orange);">@pendingCount</span>
                }
            </a>
            <a href="@Url.Action("ManageAppointments", "Secretary")" class="btn btn-info">
                <span class="glyphicon glyphicon-calendar"></span> Gérer les RDV
            </a>
            <a href="@Url.Action("PatientsList", "Secretary")" class="btn btn-success">
                <span class="glyphicon glyphicon-folder-open"></span> Dossiers patients
            </a>
            <a href="@Url.Action("Logout", "Auth")" class="btn btn-default">
                <span class="glyphicon glyphicon-log-out"></span> Déconnexion
            </a>
        </div>
    </div>

    <!-- Stats Cards - Purple Theme -->
    <div class="stats-section">
        <div class="stat-card">
            <div class="stat-card-header">
                <div class="stat-icon pink">
                    <span class="glyphicon glyphicon-hourglass"></span>
                </div>
                <div class="stat-info">
                    <div class="stat-value">@(ViewBag.PendingRequests ?? 0)</div>
                    <div class="stat-label">Demandes en attente</div>
                </div>
            </div>
            <a href="@Url.Action("AppointmentRequests", "Secretary")" class="stat-link">
                Traiter maintenant <span class="glyphicon glyphicon-chevron-right"></span>
            </a>
        </div>

        <div class="stat-card">
            <div class="stat-card-header">
                <div class="stat-icon purple">
                    <span class="glyphicon glyphicon-ok-sign"></span>
                </div>
                <div class="stat-info">
                    <div class="stat-value">@(ViewBag.ApprovedToday ?? 0)</div>
                    <div class="stat-label">Approuvées aujourd'hui</div>
                </div>
            </div>
            <a href="@Url.Action("TodayAppointments", "Secretary")" class="stat-link">
                Voir détails <span class="glyphicon glyphicon-chevron-right"></span>
            </a>
        </div>

        <div class="stat-card">
            <div class="stat-card-header">
                <div class="stat-icon dark">
                    <span class="glyphicon glyphicon-stats"></span>
                </div>
                <div class="stat-info">
                    <div class="stat-value">@(ViewBag.TotalRequestsToday ?? 0)</div>
                    <div class="stat-label">Total aujourd'hui</div>
                </div>
            </div>
            <a href="@Url.Action("Reports", "Secretary")" class="stat-link">
                Voir rapport <span class="glyphicon glyphicon-chevron-right"></span>
            </a>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="content-grid">
        <!-- Quick Actions -->
        <div class="action-tiles">
            <div class="section-title">
                <span class="glyphicon glyphicon-flash"></span>
                Actions rapides
            </div>
            <div class="tiles-grid">
                <a href="@Url.Action("AppointmentRequests", "Secretary")" class="action-tile" style="position: relative;">
                    <span class="glyphicon glyphicon-list-alt"></span>
                    <span>Traiter les demandes</span>
                    @if (pendingCount > 0)
                    {
                        <span class="badge">@pendingCount</span>
                    }
                </a>
                <a href="@Url.Action("CreateAppointment", "Secretary")" class="action-tile">
                    <span class="glyphicon glyphicon-plus"></span>
                    <span>Nouveau RDV direct</span>
                </a>
                <a href="@Url.Action("TodayAppointments", "Secretary")" class="action-tile">
                    <span class="glyphicon glyphicon-calendar"></span>
                    <span>RDV d'aujourd'hui</span>
                </a>
                <a href="@Url.Action("PatientsList", "Secretary")" class="action-tile">
                    <span class="glyphicon glyphicon-folder-open"></span>
                    <span>Dossiers patients</span>
                </a>
            </div>
        </div>

        <!-- Urgent Requests -->
        <div class="urgent-card">
            <div class="section-title">
                <span class="glyphicon glyphicon-exclamation-sign"></span>
                Demandes urgentes
            </div>
            
            @if (pendingCount > 0 && nextPending != null)
            {
                var urgencyClass = nextPending.UrgencyLevel == "Élevé" ? "priority-high" : 
                                   nextPending.UrgencyLevel == "Moyen" ? "priority-medium" : "priority-low";
                var minutesPending = Math.Max(1, (int)(DateTime.Now - nextPending.DateDemande).TotalMinutes);
                var isUrgent = nextPending.UrgencyLevel == "Élevé";
                
                <div class="request-item @(isUrgent ? "urgent" : "")">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 15px;">
                        <div style="flex: 1;">
                            <div style="margin-bottom: 10px;">
                                <span class="priority-badge @urgencyClass">@nextPending.UrgencyLevel</span>
                            </div>
                            <h5 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 700; color: var(--dark-text);">
                                @nextPending.PatientNom @nextPending.PatientPrenom
                            </h5>
                            <p style="margin: 0 0 8px 0; color: var(--light-text); font-size: 14px;">
                                @nextPending.SymptomsDescription
                            </p>
                            <small style="color: var(--light-text);">
                                <span class="glyphicon glyphicon-time"></span>
                                Il y a @minutesPending min
                            </small>
                        </div>
                        <div>
                            <a href="@Url.Action("AppointmentRequests", "Secretary")" 
                               class="btn btn-sm" 
                               style="background: var(--gradient-primary); color: white; border: none; padding: 8px 18px; border-radius: 8px; font-weight: 600;">
                                Traiter
                            </a>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
          <a href="@Url.Action("AppointmentRequests", "Secretary")" style="color: var(--primary-orange); font-weight: 600; text-decoration: none;">
          Voir toutes les demandes (@pendingCount) ?
         </a>
    </div>
            }
            else
            {
                <div class="empty-state">
                    <span class="glyphicon glyphicon-ok-circle"></span>
                    <h4 style="color: var(--light-text); margin: 10px 0;">Aucune demande urgente</h4>
                    <p style="color: #B8B8CC; margin: 0;">Toutes les demandes ont été traitées</p>
                </div>
            }
        </div>
    </div>

    <div class="services-pills">
        <div class="container">
            <p>
                <strong>créneaux horaires</strong> supplémentaires • 
                <strong>suivi</strong> de vos rendez-vous • 
                <strong>gestion</strong> des ordonnances
            </p>
        </div>
    </div>

</div>

@section Scripts {
<script>
    $(document).ready(function() {
        // Auto-refresh pending requests count every 30 seconds
        setInterval(function() {
            // You can implement AJAX call to refresh metrics
            // $.get('@Url.Action("GetPendingCount", "Secretary")', function(data) {
            //     $('.pending-count').text(data.count);
            // });
        }, 30000);

        // Highlight urgent requests
        $('.request-card.urgent').addClass('animate__animated animate__pulse');
        
        // Notification for new requests (you can implement with SignalR)
        // connection.on("NewAppointmentRequest", function (patientName) {
        //     toastr.info("Nouvelle demande de RDV de " + patientName);
        // });
    });
</script>
}
