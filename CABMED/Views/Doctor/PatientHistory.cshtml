@model CABMED.ViewModels.DoctorPatientHistoryViewModel
@{
    ViewBag.Title = "Historique médical";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    /* Professional Green Medical Theme for Doctor */
    :root {
        --primary-green: #10b981;
        --light-green: #34d399;
        --dark-green: #059669;
        --green-accent: #6ee7b7;
        --white: #FFFFFF;
        --light-bg: #F7F8FC;
        --dark-text: #2C2C54;
     --light-text: #8B8BA7;
        --card-shadow: 0 4px 20px rgba(16, 185, 129, 0.12);
        --hover-shadow: 0 8px 35px rgba(16, 185, 129, 0.2);
        --gradient-primary: linear-gradient(135deg, #10b981 0%, #34d399 100%);
 --gradient-dark: linear-gradient(135deg, #059669 0%, #10b981 100%);
      --border-color: rgba(16, 185, 129, 0.12);
    }

 body {
        background: var(--light-bg);
    }

    .patient-history-container {
        max-width: 1200px;
        margin: 30px auto;
    padding: 0 20px;
    }

    /* Page Header */
    .page-header-custom {
        background: var(--gradient-primary);
        color: white;
        padding: 40px;
        border-radius: 20px;
        margin-bottom: 35px;
        box-shadow: var(--card-shadow);
        position: relative;
        overflow: hidden;
    }

    .page-header-custom::before {
        content: '';
        position: absolute;
        top: -50%;
 right: -10%;
        width: 300px;
      height: 300px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 50%;
    }

    .page-header-custom h2 {
        margin: 0 0 12px 0;
        font-size: 30px;
        font-weight: 700;
  position: relative;
        z-index: 1;
    }

.page-header-custom p {
 margin: 0;
   opacity: 0.95;
        font-size: 15px;
      position: relative;
        z-index: 1;
    }

    /* Patient Info Card */
    .patient-info-card {
        background: white;
        border-radius: 18px;
     padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--card-shadow);
        border: 1px solid var(--border-color);
        position: relative;
        overflow: hidden;
    }

    .patient-info-card::before {
        content: '';
        position: absolute;
     top: 0;
        left: 0;
        right: 0;
     height: 4px;
        background: var(--gradient-primary);
    }

    .patient-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
      justify-content: center;
        color: white;
        font-size: 32px;
        font-weight: 700;
   box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
     margin-right: 25px;
 flex-shrink: 0;
    }

    .patient-info-content {
        display: flex;
        align-items: center;
        gap: 25px;
    }

    .patient-details {
        flex: 1;
    }

    .patient-name {
        font-size: 24px;
      font-weight: 700;
      color: var(--dark-text);
        margin: 0 0 12px 0;
    }

    .patient-meta {
        display: flex;
        gap: 25px;
        flex-wrap: wrap;
    }

    .patient-meta-item {
      display: flex;
        align-items: center;
  gap: 8px;
      color: var(--light-text);
        font-size: 14px;
    }

    .patient-meta-item .glyphicon {
 color: var(--primary-green);
        font-size: 16px;
    }

    .patient-meta-item strong {
 color: var(--dark-text);
        font-weight: 600;
}

    /* History Section */
    .history-section {
        background: white;
        border-radius: 18px;
        padding: 32px;
 margin-bottom: 30px;
        box-shadow: var(--card-shadow);
   border: 1px solid var(--border-color);
    }

    .section-title {
   font-size: 20px;
  font-weight: 700;
        color: var(--dark-text);
        margin-bottom: 25px;
        display: flex;
    align-items: center;
        gap: 12px;
    }

    .section-title .glyphicon {
     color: var(--primary-green);
        font-size: 22px;
    }

  /* History Timeline */
    .history-timeline {
        position: relative;
        padding-left: 40px;
    }

    .history-timeline::before {
        content: '';
        position: absolute;
        left: 15px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: linear-gradient(to bottom, var(--primary-green) 0%, var(--light-green) 100%);
    }

    .history-item {
     position: relative;
  margin-bottom: 25px;
   background: linear-gradient(135deg, #F7F8FC 0%, #F0F1F7 100%);
        border-radius: 14px;
        padding: 20px;
        border-left: 4px solid var(--primary-green);
        transition: all 0.3s ease;
    }

    .history-item:hover {
     transform: translateX(5px);
      box-shadow: 0 4px 18px rgba(16, 185, 129, 0.15);
    }

    .history-item::before {
        content: '';
 position: absolute;
        left: -44px;
        top: 24px;
        width: 12px;
   height: 12px;
        background: white;
        border: 3px solid var(--primary-green);
        border-radius: 50%;
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
  }

    .history-item-header {
        display: flex;
      align-items: center;
        justify-content: space-between;
  margin-bottom: 12px;
    flex-wrap: wrap;
 gap: 10px;
    }

    .history-date {
      font-size: 14px;
        font-weight: 600;
    color: var(--primary-green);
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .history-type {
  padding: 4px 12px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
  text-transform: uppercase;
  color: white;
        background: var(--gradient-primary);
     box-shadow: 0 2px 8px rgba(16, 185, 129, 0.25);
    }

    .history-summary {
   color: var(--dark-text);
    font-size: 15px;
     line-height: 1.6;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 80px 20px;
        background: white;
        border-radius: 18px;
        border: 1px solid var(--border-color);
        box-shadow: var(--card-shadow);
    }

    .empty-state .glyphicon {
    font-size: 72px;
        color: rgba(16, 185, 129, 0.15);
  margin-bottom: 20px;
    }

    .empty-state h3 {
color: var(--dark-text);
        margin: 20px 0 10px;
        font-weight: 700;
    }

    .empty-state p {
        color: var(--light-text);
     font-size: 15px;
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        flex-wrap: wrap;
    }

    .btn-back {
        background: white;
        color: var(--primary-green);
        border: 2px solid var(--border-color);
      border-radius: 12px;
        padding: 12px 24px;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-back:hover {
        background: var(--primary-green);
        color: white;
        border-color: var(--primary-green);
        transform: translateX(-3px);
 text-decoration: none;
    }

    .btn-primary-custom {
        background: var(--gradient-primary);
        color: white;
        border: none;
     border-radius: 12px;
        padding: 12px 24px;
    font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
}

    .btn-primary-custom:hover {
        background: var(--gradient-dark);
        color: white;
        transform: translateY(-2px);
   box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
   text-decoration: none;
    }

    /* Alert Styling */
    .alert-custom {
        border-radius: 12px;
        border: none;
        padding: 16px 20px;
        box-shadow: var(--card-shadow);
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        color: #1e40af;
        border-left: 4px solid #3b82f6;
        display: flex;
        align-items: center;
  gap: 12px;
    }

    .alert-custom .glyphicon {
     font-size: 20px;
    }

    @@media (max-width: 768px) {
        .patient-info-content {
            flex-direction: column;
       text-align: center;
        }

   .patient-avatar {
 margin-right: 0;
            margin-bottom: 20px;
    }

        .patient-meta {
            flex-direction: column;
        gap: 12px;
      }

  .history-timeline {
   padding-left: 30px;
        }

        .history-item::before {
            left: -34px;
        }

      .page-header-custom {
       padding: 30px 20px;
     }

        .history-section {
            padding: 25px 20px;
        }

        .action-buttons {
  flex-direction: column;
        }

      .btn-back,
  .btn-primary-custom {
    width: 100%;
      justify-content: center;
 }
    }
</style>

<div class="patient-history-container">
    
    <!-- Page Header -->
    <div class="page-header-custom">
     <h2>
       <span class="glyphicon glyphicon-user"></span>
            Historique médical du patient
        </h2>
        <p>Vue d'ensemble complète de l'historique médical</p>
    </div>

    <!-- Patient Info Card -->
    <div class="patient-info-card">
        <div class="patient-info-content">
     <div class="patient-avatar">
       @{
  var initials = "";
          if (!string.IsNullOrEmpty(Model.PatientName))
         {
     var parts = Model.PatientName.Split(' ');
initials = parts.Length > 1 ? 
      char.ToUpper(parts[0][0]).ToString() + char.ToUpper(parts[parts.Length - 1][0]).ToString() :
   char.ToUpper(parts[0][0]).ToString();
       }
           }
         @initials
        </div>
  <div class="patient-details">
      <h3 class="patient-name">@Model.PatientName</h3>
        <div class="patient-meta">
    <div class="patient-meta-item">
        <span class="glyphicon glyphicon-tag"></span>
         <span><strong>ID:</strong> @Model.PatientId</span>
  </div>
          @if (Model.DateNaissance.HasValue)
          {
          <div class="patient-meta-item">
      <span class="glyphicon glyphicon-calendar"></span>
                <span><strong>Date de naissance:</strong> @Model.DateNaissance.Value.ToString("dd/MM/yyyy")</span>
          </div>
               <div class="patient-meta-item">
      <span class="glyphicon glyphicon-time"></span>
 <span><strong>Âge:</strong> @((DateTime.Now.Year - Model.DateNaissance.Value.Year)) ans</span>
          </div>
            }
             </div>
            </div>
        </div>
    </div>

    <!-- History Section -->
    @if (Model.HistoryItems != null && Model.HistoryItems.Any())
    {
        <div class="history-section">
       <div class="section-title">
      <span class="glyphicon glyphicon-list-alt"></span>
                Historique médical (@Model.HistoryItems.Count() événements)
          </div>
   
 <div class="history-timeline">
                @foreach (var item in Model.HistoryItems)
    {
            <div class="history-item">
        <div class="history-item-header">
       <div class="history-date">
        <span class="glyphicon glyphicon-calendar"></span>
    @item.Date.ToString("dd/MM/yyyy")
</div>
       <span class="history-type">@item.Type</span>
       </div>
       <div class="history-summary">
        @item.Summary
          </div>
   </div>
      }
     </div>
        </div>
    }
    else
    {
      <div class="empty-state">
            <span class="glyphicon glyphicon-folder-open"></span>
<h3>Aucun élément d'historique</h3>
       <p>Il n'y a pas encore d'historique médical enregistré pour ce patient.</p>
        </div>
}

    <!-- Action Buttons -->
    <div class="action-buttons">
        <a href="@Url.Action("SearchPatientHistory", "Doctor")" class="btn-back">
      <span class="glyphicon glyphicon-arrow-left"></span>
     Retour à la recherche
</a>
    </div>

</div>
